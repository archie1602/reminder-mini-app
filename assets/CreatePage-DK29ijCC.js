import{u as E,a as M,b as k,r as u,U as t,j as e,S as w,B as p,I as z,d as D,R as B}from"./index-bYvpVgL_.js";import{u as R,g as h,a as U,b as V,h as F,c as P,d as Y,e as Z,f as H,C as j,T as W,N as I,S as O,F as L,i as X}from"./formHelpers-CA05hKvp.js";const _=5;function K(){const{t:s}=E(),x=M(),m=k(),{control:o,handleSubmit:f,formState:{errors:r,isDirty:b},setValue:C,watch:i}=R({resolver:U(X),mode:"onChange",defaultValues:{text:"",timeZone:h(),schedules:[]}}),{fields:l,append:S,remove:y}=V({control:o,name:"schedules"}),g=async a=>{await m.mutateAsync(a),x("/")},c=F(r),v=(i("schedules")||[]).length===0,d=u.useMemo(()=>b,[b]),N=P({hasUnsavedChanges:d,onBackClick:()=>x("/")});u.useEffect(()=>{if(t.mount.isAvailable())return t.isMounted()||t.mount(),d?t.enableConfirmation.isAvailable()&&t.enableConfirmation():t.disableConfirmation.isAvailable()&&t.disableConfirmation(),()=>{t.disableConfirmation.isAvailable()&&t.disableConfirmation()}},[d]),Y(N),Z({text:s(v?"reminder.saveAsDraft":"common.save"),onClick:f(g),enabled:!c&&!m.isPending});const T=()=>{const a=i("timeZone")||h(),n=D().tz(a).add(1,"hour").format("YYYY-MM-DDTHH:mm:ss");S({rule:{type:B.OneTime,oneTime:{fireAt:n}}})},A=u.useMemo(()=>H(),[]);return e.jsx("div",{className:"min-h-screen bg-[var(--tg-theme-bg-color)] p-4 pb-20",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-[var(--tg-theme-text-color)] mb-6",children:s("reminder.createTitle")}),e.jsxs("form",{className:"space-y-6",children:[e.jsx(j,{name:"text",control:o,render:({field:a})=>e.jsx(W,{...a,label:s("reminder.text"),placeholder:s("reminder.textPlaceholder"),error:r.text?.message?s(r.text.message):void 0,rows:3})}),e.jsx(j,{name:"timeZone",control:o,render:({field:a})=>e.jsx(w,{...a,value:a.value||"",label:s("reminder.timezone"),options:A,searchable:!0})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--tg-theme-text-color)]",children:s("reminder.schedules")}),l.length===0&&e.jsx(I,{}),l.map((a,n)=>e.jsx(O,{index:n,control:o,setValue:C,watch:i,onRemove:()=>y(n),timezone:i("timeZone")||h(),isNew:n===l.length-1,hasError:!!r.schedules?.[n]},a.id)),l.length<_?e.jsx(p,{variant:"secondary",onClick:T,className:"text-sm py-2 px-4 w-full",type:"button",children:s("common.addSchedule")}):e.jsxs("div",{className:"text-sm text-[var(--tg-theme-hint-color)] text-center py-2 flex items-center justify-center gap-1",children:[e.jsx(z,{size:16,className:"inline-block"})," ",s("reminder.maxSchedulesReached")]})]}),e.jsx(L,{errors:r,isVisible:c}),e.jsx(p,{onClick:f(g),disabled:c||m.isPending,fullWidth:!0,children:s(v?"reminder.saveAsDraft":"common.save")})]})]})})}export{K as default};
